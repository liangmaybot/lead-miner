import { existsSync, readFileSync } from 'fs';

export function config(options = {}) {
  const filepath = options.path || '.env';
  const parsed = {};

  if (!existsSync(filepath)) {
    return { parsed };
  }

  const content = readFileSync(filepath, 'utf8');
  const lines = content.split(/\r?\n/);

  for (const line of lines) {
    const trimmed = line.trim();
    if (!trimmed || trimmed.startsWith('#')) continue;
    const eqIndex = trimmed.indexOf('=');
    if (eqIndex === -1) continue;

    const key = trimmed.slice(0, eqIndex).trim();
    let value = trimmed.slice(eqIndex + 1).trim();

    if ((value.startsWith('"') && value.endsWith('"')) || (value.startsWith("'") && value.endsWith("'"))) {
      value = value.slice(1, -1);
    }

    if (!(key in process.env)) {
      process.env[key] = value;
    }

    parsed[key] = value;
  }

  return { parsed };
}

export default { config };
